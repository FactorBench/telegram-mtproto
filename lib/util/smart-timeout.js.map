{"version":3,"sources":["../../src/util/smart-timeout.js"],"names":["cancelToken","Symbol","timeoutRefs","WeakSet","pause","delay","Promise","r","setTimeout","smartTimeout","fn","args","newToken","checkRun","has","delete","promise","then","cancel","token","immediate","resolve","delayedCall"],"mappings":";;;;;;;AAEA;;;;;;AAEA,IAAMA,cAAcC,OAAO,cAAP,CAApB;;AAEA,IAAMC,cAAc,IAAIC,OAAJ,EAApB;;AAEA,IAAMC,QAASC,KAAD,IAAkC,IAAIC,kBAAJ,CAAYC,KAAKC,WAAWD,CAAX,EAAcF,KAAd,CAAjB,CAAhD;;AAEO,IAAMI,sCAAe,CAAIC,EAAJ,EAAkCL,QAAiB,CAAnD,EAAsD,GAAGM,IAAzD,KAA4E;AACtG,MAAMC,WAAWX,OAAO,WAAP,CAAjB;AACA,MAAMY,WAAW,MAAM;AACrB,QAAIX,YAAYY,GAAZ,CAAgBF,QAAhB,CAAJ,EAA+B;AAC7BV,kBAAYa,MAAZ,CAAmBH,QAAnB;AACA,aAAOF,GAAG,GAAGC,IAAN,CAAP;AACD,KAHD,MAGO,OAAO,KAAP;AACR,GALD;AAMA,MAAMK,UAAUZ,MAAMC,KAAN,EAAaY,IAAb,CAAkBJ,QAAlB,CAAhB;AACAG,UAAQhB,WAAR,IAAuBY,QAAvB;AACA,SAAOI,OAAP;AACD,CAXM;;AAaPP,aAAaS,MAAb,GAAsBF,WAAW;AAC/B,MAAI,CAACA,OAAD,IAAY,CAACA,QAAQhB,WAAR,CAAjB,EAAuC,OAAO,KAAP;AACvC,MAAMmB,QAAQH,QAAQhB,WAAR,CAAd;AACA,SAAOE,YAAYY,GAAZ,CAAgBK,KAAhB,IACHjB,YAAYa,MAAZ,CAAmBI,KAAnB,CADG,GAEH,KAFJ;AAGD,CAND;;AAQO,IAAMC,gCAAY,CAAIV,EAAJ,EAAkC,GAAGC,IAArC,KACvBL,mBACGe,OADH,GAEGJ,IAFH,CAEQ,MAAMP,GAAG,GAAGC,IAAN,CAFd,CADK;;AAMA,IAAMW,oCACX,CAAIZ,EAAJ,EAAkCL,QAAiB,CAAnD,EAAsD,GAAGM,IAAzD,KACEP,MAAMC,KAAN,EACGY,IADH,CACQ,MAAMP,GAAG,GAAGC,IAAN,CADd,CAFG;;AAKPF,aAAaW,SAAb,GAAyBA,SAAzB;AACAX,aAAaO,OAAb,GAAuBM,WAAvB;;kBAEeb,Y","file":"smart-timeout.js","sourcesContent":["//@flow\n\nimport Promise from 'bluebird'\n\nconst cancelToken = Symbol('cancel token')\n\nconst timeoutRefs = new WeakSet\n\nconst pause = (delay: number): Promise<void> => new Promise(r => setTimeout(r, delay))\n\nexport const smartTimeout = <T>(fn: (...args: Array<*>) => T, delay?: number = 0, ...args: Array<*>) => {\n  const newToken = Symbol('cancel id')\n  const checkRun = () => {\n    if (timeoutRefs.has(newToken)) {\n      timeoutRefs.delete(newToken)\n      return fn(...args)\n    } else return false\n  }\n  const promise = pause(delay).then(checkRun)\n  promise[cancelToken] = newToken\n  return promise\n}\n\nsmartTimeout.cancel = promise => {\n  if (!promise || !promise[cancelToken]) return false\n  const token = promise[cancelToken]\n  return timeoutRefs.has(token)\n    ? timeoutRefs.delete(token)\n    : false\n}\n\nexport const immediate = <T>(fn: (...args: Array<*>) => T, ...args: Array<*>) =>\n  Promise\n    .resolve()\n    .then(() => fn(...args))\n\n\nexport const delayedCall =\n  <T>(fn: (...args: Array<*>) => T, delay?: number = 0, ...args: Array<*>) =>\n    pause(delay)\n      .then(() => fn(...args))\n\nsmartTimeout.immediate = immediate\nsmartTimeout.promise = delayedCall\n\nexport default smartTimeout"]}