{"version":3,"sources":["../../src/service/dc-configurator.js"],"names":["sslSubdomains","devDC","id","host","port","prodDC","portString","findById","find","chooseServer","chosenServers","dev","webogram","dcList","dcID","upload","console","log","choosen","chosenServer","subdomain","path","dcOption"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,gBAAgB,CAAC,OAAD,EAAU,OAAV,EAAmB,QAAnB,EAA6B,OAA7B,EAAsC,OAAtC,CAAtB;;AAEA,IAAMC,QAAQ,CACZ,EAAEC,IAAI,CAAN,EAASC,MAAM,gBAAf,EAAiCC,MAAM,GAAvC,EADY,EAEZ,EAAEF,IAAI,CAAN,EAASC,MAAM,gBAAf,EAAiCC,MAAM,GAAvC,EAFY,EAGZ,EAAEF,IAAI,CAAN,EAASC,MAAM,iBAAf,EAAkCC,MAAM,GAAxC,EAHY,CAAd;;AAMA,IAAMC,SAAS,CACb,EAAEH,IAAI,CAAN,EAASC,MAAM,gBAAf,EAAiCC,MAAM,GAAvC,EADa,EAEb,EAAEF,IAAI,CAAN,EAASC,MAAM,gBAAf,EAAiCC,MAAM,GAAvC,EAFa,EAGb,EAAEF,IAAI,CAAN,EAASC,MAAM,iBAAf,EAAkCC,MAAM,GAAxC,EAHa,EAIb,EAAEF,IAAI,CAAN,EAASC,MAAM,gBAAf,EAAiCC,MAAM,GAAvC,EAJa,EAKb,EAAEF,IAAI,CAAN,EAASC,MAAM,eAAf,EAAgCC,MAAM,GAAtC,EALa,CAAf;;AAQA,IAAME,aAAa,CAAC,EAAEF,OAAO,EAAT,EAAD,KAAmBA,SAAS,EAAT,GAAc,EAAd,GAAoB,IAAGA,IAAK,EAAlE;;AAEA,IAAMG,WAAW,oBAAK,sBAAO,IAAP,CAAL,EAAmBC,cAAnB,CAAjB;;AAEO,IAAMC,sCAAe,CAC1BC,aAD0B,EAE1B;AACEC,QAAM,KADR;AAEEC,aAAW,KAFb;AAGEC,WAASF,MAAMV,KAAN,GAAcI;AAHzB,IAII,EANsB,KAOvB,CAACS,IAAD,EAAOC,SAAS,KAAhB,KAA0B;AAC7BC,UAAQC,GAAR,CAAY,iCAAZ,EAA+CP,aAA/C;AACA,MAAMQ,UAAU,oBAAKJ,IAAL,CAAhB;AACA,MAAI,mBAAIA,IAAJ,EAAUJ,aAAV,CAAJ,EAA8B;AAC5BM,YAAQC,GAAR,CAAY,2BAAZ,EAAyCC,QAAQR,aAAR,CAAzC;AACA,WAAOQ,QAAQR,aAAR,CAAP;AACD;;AAED,MAAIS,eAAe,KAAnB;AACAH,UAAQC,GAAR,CAAY,kBAAZ,EAAgC,EAAEH,IAAF,EAAQC,MAAR,EAAgBH,QAAhB,EAAhC;AACA,MAAIA,QAAJ,EAAc;AACZ,QAAMQ,YAAYpB,cAAcc,OAAO,CAArB,KAA2BC,SAAS,IAAT,GAAgB,EAA3C,CAAlB;AAAA,QACEM,OAAOV,MAAM,YAAN,GAAqB,OAD9B;;AAGAQ,mBAAgB,WAAUC,SAAU,qBAAoBC,IAAK,EAA7D;AACAL,YAAQC,GAAR,CAAY,kBAAZ,EAAgC,EAAEE,YAAF,EAAhC;AACA,WAAOA,YAAP,CANY,CAMQ;AACrB;;AAED,MAAMG,WAAWf,SAASO,IAAT,EAAeD,MAAf,CAAjB;AACA,MAAIS,QAAJ,EAAc;AACZH,mBAAgB,UAASG,SAASnB,IAAK,GAAEG,WAAWgB,QAAX,CAAqB,QAA9D;AACD;AACDZ,gBAAcI,IAAd,IAAsBK,YAAtB;;AAEAH,UAAQC,GAAR,CAAY,2BAAZ,EAAyCC,QAAQR,aAAR,CAAzC;AACA,SAAOQ,QAAQR,aAAR,CAAP;AACD,CAlCM","file":"dc-configurator.js","sourcesContent":["import has from 'ramda/src/has'\nimport propEq from 'ramda/src/propEq'\nimport find from 'ramda/src/find'\nimport pipe from 'ramda/src/pipe'\nimport prop from 'ramda/src/prop'\n\nconst sslSubdomains = ['pluto', 'venus', 'aurora', 'vesta', 'flora']\n\nconst devDC = [\n  { id: 1, host: '149.154.175.10', port: 443 },\n  { id: 2, host: '149.154.167.40', port: 443 },\n  { id: 3, host: '149.154.175.117', port: 443 }\n]\n\nconst prodDC = [\n  { id: 1, host: '149.154.175.50', port: 443 },\n  { id: 2, host: '149.154.167.51', port: 443 },\n  { id: 3, host: '149.154.175.100', port: 443 },\n  { id: 4, host: '149.154.167.91', port: 443 },\n  { id: 5, host: '149.154.171.5', port: 443 }\n]\n\nconst portString = ({ port = 80 }) => port === 80 ? '' : `:${port}`\n\nconst findById = pipe(propEq('id'), find)\n\nexport const chooseServer = (\n  chosenServers,\n  {\n    dev = false,\n    webogram = false,\n    dcList = dev ? devDC : prodDC\n  } = {}\n) => (dcID, upload = false) => {\n  console.log('[chooseServer:0] chosenServers:', chosenServers)\n  const choosen = prop(dcID)\n  if (has(dcID, chosenServers)) {\n    console.log('[chooseServer:1] choosen:', choosen(chosenServers))\n    return choosen(chosenServers)\n  }\n  \n  let chosenServer = false\n  console.log('[chooseServer:2]', { dcID, upload, webogram })\n  if (webogram) {\n    const subdomain = sslSubdomains[dcID - 1] + (upload ? '-1' : ''),\n      path = dev ? 'apiw_test1' : 'apiw1'\n\n    chosenServer = `https://${subdomain}.web.telegram.org/${path}`\n    console.log('[chooseServer:3]', { chosenServer })\n    return chosenServer //TODO Possibly bug. Isn't it necessary? chosenServers[dcID] = chosenServer\n  }\n\n  const dcOption = findById(dcID)(dcList)\n  if (dcOption) {\n    chosenServer = `http://${dcOption.host}${portString(dcOption)}/apiw1`\n  }\n  chosenServers[dcID] = chosenServer\n\n  console.log('[chooseServer:4] choosen:', choosen(chosenServers))\n  return choosen(chosenServers)\n}"]}